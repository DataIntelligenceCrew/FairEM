import matplotlib.pyplot as plt
import numpy as np

def make_acronym(word, delim):
    res = ""
    for spl in word.split(delim):
        res += spl[0].capitalize()
    return res


def plot_results_in_2d_heatmap(dataset, data, xlabels, ylabels, title, figsize = (10,7), 
                                x_font = 11, y_font = 12, vmin=-1.0, vmax=0.6, cmap="RdYlGn"):
    fig, ax = plt.subplots(figsize=figsize)
    im = ax.imshow(data, cmap=cmap, vmin=vmin, vmax=vmax)

    fig.colorbar(im, shrink=0.5)
    ax.set_xticks(np.arange(len(xlabels)))
    ax.set_xticklabels(labels=xlabels, fontdict={'fontsize': x_font})
    ax.set_yticks(np.arange(len(ylabels)))
    ax.set_yticklabels(labels=ylabels, fontdict={'fontsize': y_font})

    plt.setp(ax.get_xticklabels(), rotation=60, ha="right",
            rotation_mode="anchor")

    thr = round((vmin + vmax)/2, 2)
    for i in range(len(data)):
        for j in range(len(data[0])):
            if abs(data[i][j] - thr) > 0.2:
                color = "w"
            else:
                color = "black"
            text = ax.text(j, i, round(data[i][j],2),
                        ha="center", va="center", color=color)
            
    # ax.set_title(title, fontdict={'fontsize': 24})
    fig.tight_layout()
    plt.savefig("../experiments/" + dataset + "/" + title.replace("\n","") + " deepmatcher.png", dpi=100)
    plt.close()

attributes =  ['Dance', 'Electronic', 'Music', 'Pop', 'R&B / Soul', 'Rock', 'other', 'Contemporary Country', 'Country', 'Dance & Electronic', 'Alternative', 'Hip-Hop/Rap', 'Rap', 'Rap & Hip-Hop', 'East Coast Rap', 'Hardcore Rap', 'House']
measures =  ['accuracy_parity',
             'statistical_parity',
             'true_positive_rate_parity',
             'false_positive_rate_parity',
             'false_negative_rate_parity',
             'true_negative_rate_parity',
             'negative_predictive_value_parity',
             'false_discovery_rate_parity',
             'false_omission_rate_parity']

# actual_fairness_ditto =  [[0.00523349436392917, -0.021164021164021163, 0.0, -0.16517323775388293, -0.34259259259259256, -0.002592592592592591, -0.04894179894179895, -0.15028490028490027, -0.19973544973544965, 0.036195286195286225, 0.15740740740740744, 0.15740740740740744, 0.1174074074074074, 0.15740740740740744, 0.15740740740740744, 0.15740740740740744, -0.05687830687830686], [-0.023349436392914646, -0.06216931216931215, 0.0, 0.04958183990442058, -0.040740740740740716, 0.0392592592592593, 0.0291005291005291, 0.29772079772079774, 0.2592592592592593, -0.0286195286195286, 0.09259259259259259, -0.08074074074074072, -0.08074074074074072, -0.09259259259259259, -0.08689458689458687, -0.1074074074074074, -0.09788359788359788], [-0.005376344086021501, -0.005376344086021501, 0.0, -0.08870967741935487, -0.33870967741935487, 0.03629032258064513, -0.06598240469208216, 0.03629032258064513, 0.03629032258064513, 0.03629032258064513, 0.16129032258064513, 0.16129032258064513, 0.16129032258064513, 0.16129032258064513, 0.16129032258064513, 0.16129032258064513, -0.17204301075268824], [-0.008785332314744071, 0.025974025974025983, 0.0, 0.2125768967874231, 0.34415584415584416, 0.02062643239113829, 0.03927779537535636, 0.44415584415584414, 0.5108225108225108, -0.035844155844155845, -0.15584415584415584, -0.15584415584415584, -0.10822510822510822, -0.15584415584415584, -0.15584415584415584, -0.15584415584415584, 0.025974025974025983], [0.005376344086021501, 0.005376344086021501, 0.0, 0.08870967741935484, 0.33870967741935487, -0.03629032258064516, 0.06598240469208211, -0.03629032258064516, -0.03629032258064516, -0.03629032258064516, -0.16129032258064516, -0.16129032258064516, -0.16129032258064516, -0.16129032258064516, -0.16129032258064516, -0.16129032258064516, 0.17204301075268816], [0.008785332314744099, -0.02597402597402587, 0.0, -0.2125768967874231, -0.3441558441558441, -0.02062643239113826, -0.03927779537535625, -0.4441558441558441, -0.5108225108225108, 0.0358441558441559, 0.1558441558441559, 0.1558441558441559, 0.10822510822510822, 0.1558441558441559, 0.1558441558441559, 0.1558441558441559, -0.02597402597402587], [0.006912442396313279, 0.018796992481202923, 0.0, -0.12857142857142856, -0.3285714285714286, 0.004761904761904745, -0.06015037593984962, -0.261904761904762, -0.261904761904762, 0.02795031055900621, 0.0714285714285714, 0.0714285714285714, 0.0714285714285714, 0.0714285714285714, 0.0714285714285714, 0.0714285714285714, -0.02857142857142858], [0.017543859649122806, 0.1286549707602339, 0.0, 0.12171052631578949, 0.28421052631578947, -0.01578947368421052, 0.004210526315789498, -0.01578947368421052, 0.04784688995215314, -0.01578947368421052, -0.3157894736842105, -0.3157894736842105, -0.1157894736842105, -0.3157894736842105, -0.3157894736842105, -0.3157894736842105, 0.1842105263157895], [-0.006912442396313362, -0.018796992481203006, 0.0, 0.1285714285714286, 0.3285714285714286, -0.004761904761904759, 0.06015037593984962, 0.26190476190476186, 0.26190476190476186, -0.02795031055900621, -0.07142857142857142, -0.07142857142857142, -0.07142857142857142, -0.07142857142857142, -0.07142857142857142, -0.07142857142857142, 0.02857142857142858]]
actual_fairness_deepmatcher =  [[-0.022946859903381633, 0.015873015873015817, 0.0, -0.03136200716845883, -0.2055555555555556, 0.03444444444444439, -0.04365079365079372, -0.11324786324786329, -0.09126984126984128, -0.017676767676767735, 0.11111111111111105, 0.03444444444444439, 0.03444444444444439, 0.04629629629629628, 0.040598290598290565, 0.061111111111111116, 0.051587301587301515], [-0.06763285024154589, -0.07539682539682539, 0.0, 0.08243727598566308, -0.1111111111111111, 0.06888888888888889, 0.031746031746031744, 0.35042735042735046, 0.31746031746031744, -0.0808080808080808, 0.1388888888888889, -0.1111111111111111, -0.1111111111111111, -0.1111111111111111, -0.1111111111111111, -0.1111111111111111, -0.03968253968253968], [-0.22043010752688172, -0.22043010752688172, 0.0, 0.11290322580645162, -0.3870967741935484, 0.17540322580645162, 0.02199413489736074, 0.3629032258064516, 0.3629032258064516, -0.2620967741935484, 0.3629032258064516, -0.3870967741935484, -0.3870967741935484, -0.3870967741935484, -0.3870967741935484, -0.3870967741935484, -0.05376344086021506], [-0.025974025974025976, -0.025974025974025976, 0.0, 0.026657552973342442, -0.025974025974025976, 0.003437738731856377, 0.022806461830852075, 0.37402597402597404, 0.30735930735930733, -0.025974025974025976, -0.025974025974025976, -0.025974025974025976, -0.025974025974025976, -0.025974025974025976, -0.025974025974025976, -0.025974025974025976, -0.025974025974025976], [0.22043010752688175, 0.22043010752688175, 0.0, -0.11290322580645162, 0.3870967741935484, -0.17540322580645162, -0.021994134897360684, -0.3629032258064516, -0.3629032258064516, 0.2620967741935484, -0.3629032258064516, 0.3870967741935484, 0.3870967741935484, 0.3870967741935484, 0.3870967741935484, 0.3870967741935484, 0.053763440860215006], [0.025974025974025983, 0.025974025974025983, 0.0, -0.02665755297334249, 0.025974025974025983, -0.003437738731856377, -0.02280646183085211, -0.37402597402597404, -0.3073593073593074, 0.025974025974025983, 0.025974025974025983, 0.025974025974025983, 0.025974025974025983, 0.025974025974025983, 0.025974025974025983, 0.025974025974025983, 0.025974025974025983], [-0.025145067698259194, 0.01694247438928287, 0.0, -0.0478723404255319, -0.19787234042553192, 0.027127659574468055, -0.0478723404255319, -0.19787234042553192, -0.13120567375886527, -0.0166223404255319, 0.09101654846335694, 0.04212765957446807, 0.04212765957446807, 0.05397951142631996, 0.048281505728314245, 0.0687943262411348, 0.048281505728314245], [-0.14285714285714285, -0.14285714285714285, 0.0, 0.0, -0.14285714285714285, -0.042857142857142844, 0.038961038961038974, 0.10714285714285715, 0.10714285714285715, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285, -0.14285714285714285], [0.025145067698259194, -0.016942474389282897, 0.0, 0.04787234042553193, 0.19787234042553195, -0.027127659574468083, 0.04787234042553193, 0.19787234042553195, 0.13120567375886524, 0.01662234042553193, -0.09101654846335697, -0.04212765957446807, -0.04212765957446807, -0.05397951142631993, -0.04828150572831422, -0.06879432624113474, -0.04828150572831422]]
good_measures = ["accuracy_parity",
            "statistical_parity",
            "true_positive_rate_parity",
            "true_negative_rate_parity",
            "negative_predictive_value_parity"]

bad_measures = ["false_positive_rate_parity",
            "false_negative_rate_parity",
            "false_discovery_rate_parity",
            "false_omission_rate_parity"]


good_measures_acronymes = [make_acronym(x, "_") for x in good_measures]
bad_measures_acronymes = [make_acronym(x, "_") for x in bad_measures]
good_measures_fairness = []
bad_measures_fairness = []


for i in range(len(measures)):
    measure = measures[i]
    if measure in set(good_measures):
        good_measures_fairness.append(actual_fairness_deepmatcher[i])
    else:
        bad_measures_fairness.append(actual_fairness_deepmatcher[i])
    

for i in range(len(good_measures_fairness)):
    for j in range(len(good_measures_fairness[i])):
        good_measures_fairness[i][j] *= -1

final_measures_acronyms = good_measures_acronymes + bad_measures_acronymes
final_fairness = good_measures_fairness + bad_measures_fairness

# plot_results_in_2d_heatmap("itunes-amazon", good_measures_fairness, 
#                             attributes, good_measures_acronymes,
#                             "Actual Fairness for Positive Measures",
#                             vmin=-0.7, vmax=0.3, cmap="RdYlGn")

# plot_results_in_2d_heatmap("itunes-amazon", bad_measures_fairness, 
#                             attributes, bad_measures_acronymes,
#                             "Actual Fairness for Negative Measures",
#                             vmin=-0.3, vmax=0.7, cmap="RdYlGn_r")

plot_results_in_2d_heatmap("itunes-amazon", final_fairness, 
                            attributes, final_measures_acronyms,
                            "Actual Fairness for All Measures",
                            vmin=-0.3, vmax=0.7, cmap="RdYlGn_r")
